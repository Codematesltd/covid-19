<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign Up | Viralytics</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-white min-h-screen">
  <!-- Navigation -->
  <nav class="bg-white shadow-lg">
    <div class="max-w-6xl mx-auto px-4">
      <div class="flex justify-between">
        <div class="flex space-x-7">
          <a href="{{ url_for('home') }}" class="flex items-center space-x-2 py-4">
            <svg class="h-8 w-8 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
              <path d="M2 3a1 1 0 011-1h6v2H4v12h12V9h2v8a1 1 0 01-1 1H3a1 1 0 01-1-1V3z"/>
              <path d="M9 2h7a1 1 0 011 1v7h-2V4H9V2z"/>
            </svg>
            <span class="font-bold text-blue-600 text-lg">Viralytics</span>
          </a>
          <div class="flex items-center space-x-1">
            <a href="{{ url_for('about') }}" class="py-4 px-2 text-gray-500 hover:text-blue-600">About</a>
            <a href="{{ url_for('contact') }}" class="py-4 px-2 text-gray-500 hover:text-blue-600">Contact</a>
          </div>
        </div>
        <div class="flex items-center space-x-3">
          <a href="{{ url_for('sign_in') }}" class="py-2 px-4 text-blue-600 hover:text-blue-700">Sign In</a>
          <a href="{{ url_for('sign_up') }}" class="py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Sign Up</a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Sign Up Section -->
  <div class="flex flex-col items-center justify-center py-12 px-4">
    <div class="w-full max-w-md p-8 bg-white rounded-2xl shadow-xl">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-gray-800">Join <span class="text-blue-600">Viralytics</span></h2>
      </div>
      <form id="signup-form" method="post" action="{{ url_for('sign_up') }}" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700">Full Name</label>
          <input name="full_name" id="full_name" type="text" placeholder="Dr. Jane Smith" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Email Address</label>
          <input name="email" type="email" placeholder="jane.smith@hospital.com" class="w-full mt-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none" required pattern="^[\w\.-]+@[\w\.-]+\.\w{2,}$">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Institution</label>
          <input name="institution" type="text" placeholder="Medical Center" class="w-full mt-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Password</label>
          <input name="password" type="password" class="w-full mt-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none" required minlength="8" pattern=".{8,}">
          <span class="text-xs text-gray-500">Minimum 8 characters</span>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Confirm Password</label>
          <input name="confirm_password" type="password" class="w-full mt-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none" required minlength="8" pattern=".{8,}">
        </div>
        <div class="flex items-start">
          <input type="checkbox" class="mt-1 mr-2 form-checkbox text-blue-600">
          <span class="text-sm text-gray-700">I agree to the <a href="#" class="text-blue-600 hover:underline">Terms of Service</a> and <a href="#" class="text-blue-600 hover:underline">Privacy Policy</a>.</span>
        </div>
        <div id="error-msg" class="text-red-500 mt-2">
          {% if error %}
            {{ error }}
          {% endif %}
        </div>
        <button type="submit" id="signup-btn" class="w-full py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center justify-center">
          <span id="signup-btn-text">Create Account</span>
          <svg id="signup-spinner" class="hidden ml-2 h-5 w-5 text-white animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
          </svg>
        </button>
      </form>
      <p class="mt-6 text-center text-sm">Already have an account? <a href="{{url_for('sign_in')}}" class="text-blue-600 hover:underline">Sign in</a></p>
    </div>
  </div>

  <script>
    const form = document.getElementById('signup-form')
    const errorDiv = document.getElementById('error-msg')
    const signupBtn = document.getElementById('signup-btn')
    const signupBtnText = document.getElementById('signup-btn-text')
    const signupSpinner = document.getElementById('signup-spinner')

    form.addEventListener('submit', async e => {
      errorDiv.textContent = ''
      // Client-side validation
      const email = form.email.value.trim()
      const password = form.password.value
      const confirm = form.confirm_password.value
      const emailPattern = /^[\w\.-]+@[\w\.-]+\.\w{2,}$/
      if (!emailPattern.test(email)) {
        e.preventDefault()
        errorDiv.textContent = "Please enter a valid email address."
        return
      }
      if (password.length < 8) {
        e.preventDefault()
        errorDiv.textContent = "Password must be at least 8 characters."
        return
      }
      if (password !== confirm) {
        e.preventDefault()
        errorDiv.textContent = "Passwords do not match."
        return
      }
      signupBtn.disabled = true
      signupBtnText.textContent = 'Creating...'
      signupSpinner.classList.remove('hidden')
      const formData = new FormData(form)
      const res = await fetch(form.action, {
        method: 'POST',
        body: formData
      })
      // if backend redirects on success
      if (res.redirected) {
        window.location.href = res.url
        return
      }
      // on error, parse returned HTML for the error message
      const text = await res.text()
      const doc = new DOMParser().parseFromString(text, 'text/html')
      const err = doc.getElementById('error-msg')?.textContent
      errorDiv.textContent = err || 'Signup failed'
      signupBtn.disabled = false
      signupBtnText.textContent = 'Create Account'
      signupSpinner.classList.add('hidden')
    })
  </script>
</body>
</html>
